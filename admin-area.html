<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>YAWATA CASINO - REMOTE CONTROL</title>
    <script src="https://yawata-casino.onrender.com/socket.io/socket.io.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; border: 1px solid #0f0; padding: 20px; box-shadow: 0 0 15px #0f0; }
        input { background: #111; color: #0f0; border: 1px solid #0f0; padding: 8px; margin: 5px; }
        button { background: #0f0; color: #000; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; }
        button:hover { background: #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #0f0; padding: 10px; text-align: left; }
        .status { color: yellow; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“¡ YAWATA REMOTE SYSTEM</h1>
        <div id="auth-section">
            <input type="password" id="master-key" placeholder="MASTER KEY">
            <button onclick="connectAdmin()">SYSTEM LOGIN</button>
        </div>

        <div id="admin-panel" style="display:none;">
            <p class="status" id="status-msg">CONNECTED / AUTHORIZED</p>
            <button onclick="fetchUsers()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’æ›´æ–°</button>
            <table id="user-table">
                <thead>
                    <tr><th>PLAYER</th><th>CHIPS</th><th>BANK</th><th>IP</th><th>ACTION</th></tr>
                </thead>
                <tbody id="user-list-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        // --- è¨­å®šï¼šRenderã®URLã‚’ã“ã“ã«è¨˜è¿° ---
        const CASINO_URL = "https://yawata-casino.onrender.com"; 
        const socket = io(CASINO_URL);

        function connectAdmin() {
            const key = document.getElementById('master-key').value;
            socket.emit('admin_remote_login', { key });
        }

        socket.on('admin_auth_success', (d) => {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            fetchUsers();
        });

        function fetchUsers() {
            socket.emit('admin_remote_command', { type: 'get_users' });
        }

        socket.on('admin_remote_data', data => {
            if (data.type === 'user_list') {
                const tbody = document.getElementById('user-list-body');
                tbody.innerHTML = data.users.map(u => `
                    <tr>
                        <td>${u.name}</td>
                        <td><input type="number" id="chips-${u.name}" value="${u.chips}" style="width:100px;"></td>
                        <td>${u.bank}</td>
                        <td>${u.ip || '---'}</td>
                        <td>
                            <button onclick="updateUser('${u.name}')">ä¿®æ­£</button>
                            <button onclick="banUser('${u.name}')" style="background:red; color:white;">BAN</button>
                        </td>
                    </tr>
                `).join('');
            }
        });

        function updateUser(name) {
            const amount = document.getElementById(`chips-${name}`).value;
            socket.emit('admin_remote_command', { 
                type: 'update_chips', 
                target: name, 
                amount: parseInt(amount) 
            });
            alert(name + " ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
        }

        function banUser(name) {
            if (confirm(name + " ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                socket.emit('admin_remote_command', { type: 'ban_user', target: name });
            }
        }

        socket.on('admin_remote_msg', d => alert(d.msg));
    </script>
</body>
</html>
